---
layout: post
title: Play Framework - Enumerator.outputStream
tags:
- playframework
- Programming
- Web
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _flattr_post_hidden: '0'
  _flattr_post_customurl: ''
  dsq_thread_id: '924340312'
---
A few weeks ago, <a href="https://github.com/playframework/Play20/commit/0f1ec1479e490f2c8af4cd79dd0b6a14b0ea9f75">we've introduced</a> a new feature in <a href="http://www.playframework.org/">Play Framework</a>: the [cci_scala]Enumerator.outputStream[/cci_scala] method, allowing you to work with Java API requiring an [cci_java]OutputStream[/cci_java] to generate content, for instance the [cci_java]java.util.zip[/cci_java] API.

<strong>Now, let's see how easy it is to serve a big Zip generated on-the-fly without memory load with Play Framework.</strong>

<!--more-->

<h2>The Zip generation example</h2>

<script src="https://gist.github.com/4058734.js?file=Application.scala"></script>

This demo shows how to <strong>generate a zip file on-the-fly</strong> and directly <strong>stream it</strong> to an HTTP client <strong>without loading it in memory or storing it in a file</strong>.

It uses an [cci_scala]Enumerator[/cci_scala] created with the [cci_scala]Enumerator.outputStream[/cci_scala] method. 
The [cci_scala]OutputStream[/cci_scala] provided by the method is then plugged to the Java's [cci_java]ZipOutputStream[/cci_java].

For the example, we have generated a zip containing 100 text files, and each text files contains 100'000 random long numbers (yes, 100'000 !).

The zip size is approximatively 100 Mb. (and is generated in about 3Mb/s in my machine in localhost, but this can be improved)

The huge benefit of this is the download starts instantly, it means the Zip is streamed while it is generated.

<h2>Show me the code!</h2>

Internally, it is implemented with a [cci_scala]Concurrent.unicast[/cci_scala], and a simple implementation of an [cci_scala]OutputStream[/cci_scala] pushing into the unicast's channel:

<script src="https://gist.github.com/4058734.js?file=Enumerator.scala"></script>

<h2>About Iteratee and Enumerator</h2>
If you want to learn more about Iteratee concepts in Play Framework, I recommend you this article: <a href="http://mandubian.com/2012/08/27/understanding-play2-iteratees-for-normal-humans/">http://mandubian.com/2012/08/27/understanding-play2-iteratees-for-normal-humans/</a>.
